<%page expression_filter="h"/>
<%
import sys
from splunk.appserver.mrsparkle.lib.util import make_splunkhome_path
sys.path.append(make_splunkhome_path(['etc', 'apps', 'Splunk_TA_vmware', 'appserver', 'controllers']))
import splunk
from splunk_for_vmware_setup import isValidAdmin
	
# Get cherry key
session_key = cherrypy.session.get('sessionKey')

# Get cherry username
user = cherrypy.session['user']['name']

# Get capabilities
validadmin = isValidAdmin(user, session_key)

%>
<%inherit file="//layout/base.html" />
<%namespace name="lib" file="//lib.html" import="*"/>
<%namespace name="helpers" file="//view/_helpers.html" import="*"/>

<%def name="head()">
	<% parent.head() %>
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="Mon, 22 Jul 2002 11:12:01 GMT">
</%def>

<%def name="css()">
	<% CSSFiles = [
		"/static/css/skins/default/default.css",
		"/static/app/Splunk_TA_vmware/stylesheets/collection_setup.css",
		"/static/app/SA-VMNetAppUtils/stylesheets/font-awesome.min.css",
		"/static/app/Splunk_TA_vmware/stylesheets/jqueryui-splunk.css"
	] %>
	
	<%lib:stylesheet_tags files="${CSSFiles}" />
<% 
splunkVersion = splunk.getReleaseVersion()
if splunkVersion.startswith("5."):
	jsFiles = ['/static/app/SA-VMNetAppUtils/scripts/contrib/d3.v3.min.js',
		'/static/app/SA-VMNetAppUtils/scripts/contrib/jquery-ui-1.8.21.custom.min.js'
	]
elif splunkVersion.startswith("6.1"):
	jsFiles = ['/static/app/SA-VMNetAppUtils/scripts/contrib/d3.v3.min.js',
		'/static/js/contrib/jquery-ui-1.10.3.min.js'
	]
else:
	jsFiles = ['/static/app/SA-VMNetAppUtils/scripts/contrib/d3.v3.min.js',
		'/static/js/contrib/jquery/jqueryui.js'
	]
%> 
	<%lib:script_tags files="${jsFiles}" />
</%def>

${csrf_hidden_input()}
<div id="disable-overlay" class="ui-overlay ui-widget-overlay" style="display: none;">
	<p style=" position:absolute; top:50%; text-align: center; width: 100%;">
				Verifying data with server...
	</p>
</div>

## Preform the following if the user accessing the page is a valid admin:
% if validadmin == "splunk_vmware_admin":
	<div>
		<p>
		    Note: From app version 3.4.1 onwards, user is required to have "admin_all_objects" capability in "splunk_vmware_admin" role to update/validate the configuration on this page and also make sure Splunk user of DCN has "admin_all_objects" capability while configuring DCN. Please contact your Splunk administrator if not provided.
		</p>
	</div>
	<div class="layout">
	<div id="hydra-node-wrapper" class="conf-panel">
		<h1>
			Data Collection Nodes
		</h1>
		<div style="float: left; clear: both;">
			<div class="plus-box" style="float: left; clear: left;">
				<i id="hydra-node-add" class="icon-plus clickable conf-icon node-icon"></i>
			</div>
			<div id="hydra-node-nodebar-container" class="node-bar">
				
			</div>
		</div>
		<div id="selected-hydra-node-info" class="conf-info">
			<h2 class="selected-name" style="float:left;clear:left;">
				None Selected...
			</h2>
			<div class="button-bar">
				<i id="selected-hydra-node-validate" class="icon-refresh clickable conf-icon"></i>
				<i id="selected-node-edit" class="icon-pencil clickable conf-icon"></i>
				<i id="hydra-node-delete" class="icon-trash clickable conf-icon"></i>
			</div>
			<table class="conf-info-display conf-info-actions">
				<tr>
					<th >
							Splunk Forwarder Username:
					</th>
					<td  class="selected-username" colspan="2">
						please select a node...
					</td>
				</tr>
				<tr>
					<th>
						Worker Processes:
					</th>
					<td class="selected-heads" colspan="2">
						please select a node...
					</td>
				</tr>
				<tr>
					<th>
						Credential Validation:
					</th>
					<td class="selected-cred-validated">
						please select a node...
					</td>
					<td class="selected-cred-msg invalid">
						
					</td>
				</tr>
				<tr>
					<th>
						Add-on Validation:
					</th>
					<td class="selected-addon-validated">
						please select a node...
					</td>
					<td class="selected-addon-msg invalid">
						
					</td>
				</tr>
			</table>
		</div>
		<div id="hydra-node-dialog" class="conf-dialog-content" title="Edit Data Collection Node" style="display: none;">
			<p class="validate-tips">All fields are required.</p>
			<form>
				<input type="hidden" name="node_name" id="dialog-node-name" class="text dialog-field"/>
				<table class="conf-dialog-table">
					<tr>
						<th>
							<label for="node_path">Splunk Forwarder URI:</label>
						</th>
						<td>
							<input type="text" name="node_path" id="dialog-node-path" class="text ui-widget-content ui-corner-all dialog-field" placeholder="https://10.10.10.10:8089"/>
						</td>
					</tr>
					<tr>
						<th >
							<label for="node_username">Splunk Forwarder Username:</label>
						</th>
						<td>
							<input type="text" name="node_username" id="dialog-node-username" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="node_password">Splunk Forwarder Password:</label>
						</th>
						<td>
							<input type="password" name="node_password" id="dialog-node-password" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="node_heads">Worker Processes:</label>
						</th>
						<td>
							<input type="text" name="node_heads" id="dialog-node-heads" value="" class="text ui-widget-content ui-corner-all dialog-field" placeholder="1-30"/>
						</td>
					</tr>
				</table>
			</form>
		</div>
		<div id="hydra-node-delete-confirm-dialog" title="Really Delete Collection Node?" style="display: none;">
			<table style="margin-top: 16px;">
				<tr>
					<td style="padding-right: 15px;">
						<i class="icon-warning-sign conf-icon"></i>
					</td>
					<td>
						This Collection Node will be permanently deleted. This operation cannot be undone. Are you sure?
					</td>
				</tr>
			</table>
		</div>
	</div>
	<div id="vc-wrapper" class="conf-panel">
		<h1>
			Virtual Centers
		</h1>
		<div style="float: left; clear: both;">
			<div class="plus-box" style="float: left; clear: left;">
				<i id="vc-add" class="icon-plus clickable conf-icon node-icon"></i>
			</div>
			<div id="vc-nodebar-container" class="node-bar">
				
			</div>
		</div>
		<div id="selected-vc-info" class="conf-info">
			<h2 class="selected-name" style="float:left;clear:left;">
				None Selected...
			</h2>
			<div class="button-bar">
				<i id="selected-vc-validate" class="icon-refresh clickable conf-icon"></i>
				<i id="selected-vc-edit" class="icon-pencil clickable conf-icon"></i>
				<i id="vc-delete" class="icon-trash clickable conf-icon"></i>
			</div>
			<table class="conf-info-display conf-info-actions">
				<tr>
					<th>
						 VC Username:
					</th>
					<td class="selected-username" colspan="3">
						please select a vc...
					</td>
				</tr>
				<tr>
					<th>
						Collecting from:
					</th>
					<td id="selected-vc-hosts" class="selected-hosts" colspan="2">please select a vc...</td>
					<td class="selected-vc-msg">
						
					</td>
				</tr>
				<tr>
					<th>
						VC Credential Validation:
					</th>
					<td class="selected-cred-validated" >
						please select a vc...
					</td>
					<td class="selected-cred-msg invalid" colspan="2">
						
					</td>
				</tr>
				<tr class="vclog_info_row"  >
					<th>
						VC Forwarder Credential Validation:
					</th>
					<td class="selected-vclog-validated" >
						please select a vc...
					</td>
					<td class="selected-vclog-msg invalid" colspan="2">
						
					</td>
				</tr>
				<tr class="vclog_info_row"  >
					<th>
						VC Forwarder Add-on Validation:
					</th>
					<td class="selected-vclog-addon-validated" >
						please select a vc...
					</td>
					<td class="selected-vclog-addon-msg invalid" colspan="2">
						
					</td>
				</tr>

			</table>
		</div>
		<div id="vc-dialog" class="conf-dialog-content" title="Edit Virtual Center" style="display: none;">
			<p class="validate-tips">All fields are required.</p>
			<form>
				<input type="hidden" name="vc_name" id="dialog-vc-name" class="text dialog-field"/>
				<table class="conf-dialog-table">
					<tr>
						<th>
							<label for="vc_path">Virtual Center FQDN:</label>
						</th>
						<td>
							<input type="text" name="vc_path" id="dialog-vc-path" class="text ui-widget-content ui-corner-all dialog-field" placeholder="vcenter.example.com"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="vc_username">VC Username:</label>
						</th>
						<td>
							<input type="text" name="vc_username" id="dialog-vc-username" value="" class="text ui-widget-content ui-corner-all dialog-field" placeholder="user@domain"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="vc_password">VC Password:</label>
						</th>
						<td>
							<input type="password" name="vc_password" id="dialog-vc-password" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="vc_collect_vc_logs">Collect VC Logs:</label>
						</th>
						<td>
							<input type="checkbox" name="vc_collect_vc_logs" id="dialog-vc-collect-logs" class="ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr class="dialog-vc-log-options">
						<th>
							<label for="vc_splunk_uri">VC Splunk Forwarder URI:</label>
						</th>
						<td>
							<input type="text" name="vc_splunk_uri" id="dialog-vc-splunk-uri" value="" class="text ui-widget-content ui-corner-all dialog-field" placeholder="https://vcenter.example.com:8089"/>
						</td>
					</tr>
					<tr class="dialog-vc-log-options">
						<th>
							<label for="vc_splunk_username">VC Splunk Forwarder Username:</label>
						</th>
						<td>
							<input type="text" name="vc_splunk_username" id="dialog-vc-splunk-username" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr class="dialog-vc-log-options">
						<th>
							<label for="vc_splunk_password">VC Splunk Forwarder Password:</label>
						</th>
						<td>
							<input type="password" name="vc_splunk_password" id="dialog-vc-splunk-password" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="vc_collect_all_hosts">Collect from all hosts:</label>
						</th>
						<td>
							<input type="checkbox" name="vc_collect_all_hosts" id="dialog-vc-collect-all-hosts" checked="checked" class="ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr class="dialog-vc-host-options" style="display: none;">
						<th>
							<label for="vc_host_whitelist">Host Whitelist Regex:</label>
						</th>
						<td>
							<input type="text" name="vc_host_whitelist" id="dialog-vc-host-whitelist" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr class="dialog-vc-host-options" style="display: none;">
						<th>
							<label for="vc_host_blacklist">Host Blacklist Regex:</label>
						</th>
						<td>
							<input type="text" name="vc_host_blacklist" id="dialog-vc-host-blacklist" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
				</table>
			</form>
		</div>
		<div id="vc-delete-confirm-dialog" title="Really Delete Virtual Center?" style="display: none;">
			<table style="margin-top: 16px;">
				<tr class="log-collection-warning">
					<td style="padding-right: 15px;">
						<i class="icon-warning-sign icon-large" style="color:red;"></i>
					</td>
					<td style="color:red;">
						Log collection is still configured for this virtual center, if you delete it without reverting log collection configuration, you may still receive log data.
						<br />
						To revert the log collection configuration, exit this dialog, and simply uncheck the collect log checkboxes in the edit virtual center dialog.
					</td>
				</tr>
				<tr>
					<td style="padding-right: 15px;">
						<i class="icon-warning-sign icon-large"></i>
					</td>
					<td>
						This Virtual Center will be permanently deleted. This operation cannot be undone. Are you sure?
					</td>
				</tr>
			</table>
		</div>
		<div id="vc-hosts-dialog" class="conf-dialog-content" title="Managed Hosts" style="display: none;">
			<table class="conf-dialog-table" style="margin-top: 15px;">
				<tr>
					<th>
						<strong>Included Hosts</strong>
					</th>
					<th>
						<strong>Excluded Hosts</strong>
					</th>
				</tr>
				<tr>
					<td style="vertical-align: top;">
						<ul id="vc-included-hosts-list" style="padding-left: 20px;"></ul>
						<span id="vc-included-hosts-msg"></span>
					</td>
					<td style="vertical-align: top;">
						<ul id="vc-excluded-hosts-list" style="padding-left: 20px;"></ul>
						<span id="vc-excluded-hosts-msg"></span>
					</td>
				</tr>
			</table>
		</div>
	</div>
	</div>
	<div id="unmanaged-wrapper" class="conf-panel" style="display:none;">
		<h1>
			Unmanaged Hosts
		</h1>
		<div style="float: left; clear: both;">
			<div class="plus-box" style="float: left; clear: left;">
				<i id="unmanaged-add" class="icon-plus clickable conf-icon node-icon"></i>
			</div>
			<div id="unmanaged-nodebar-container" class="node-bar">
				
			</div>
		</div>
		<div id="selected-unmanaged-info" class="conf-info">
			<h2 class="selected-name" style="float:left;clear:left;">
				None Selected...
			</h2>
			<div class="button-bar">
				<i id="selected-unmanaged-validate" class="icon-refresh clickable conf-icon"></i>
				<i id="selected-unmanaged-edit" class="icon-pencil clickable conf-icon"></i>
				<i id="unmanaged-delete" class="icon-trash clickable conf-icon"></i>
			</div>
			<table class="conf-info-display conf-info-actions">
				<tr>
					<th>
						Username:
					</th>
					<td class="selected-username" colspan="2">
						please select an unmanaged host...
					</td>
				</tr>
				<tr>
					<th>
						Credential Validatation:
					</th>
					<td class="selected-cred-validated">
						please select an unmanaged host...
					</td>
					<td class="selected-cred-msg invalid">
						
					</td>
				</tr>
			</table>
		</div>
		<div id="unmanaged-dialog" class="conf-dialog-content" title="Edit Unmanaged Host" style="display: none;">
			<p class="validate-tips">All fields are required.</p>
			<form>
				<input type="hidden" name="unmanaged_name" id="dialog-unmanaged-name" class="text dialog-field"/>
				<table class="conf-dialog-table">
					<tr>
						<th>
							<label for="unmanaged_path">Unmanaged Host Domain:</label>
						</th>
						<td>
							<input type="text" name="unmanaged_path" id="dialog-unmanaged-path" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="unmanaged_username">Username:</label>
						</th>
						<td>
							<input type="text" name="unmanaged_username" id="dialog-unmanaged-username" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
					<tr>
						<th>
							<label for="unmanaged_password">Password:</label>
						</th>
						<td>
							<input type="password" name="unmanaged_password" id="dialog-unmanaged-password" value="" class="text ui-widget-content ui-corner-all dialog-field"/>
						</td>
					</tr>
				</table>
			</form>
		</div>
		<div id="unmanaged-delete-confirm-dialog" title="Really Delete Unmanaged Host?" style="display: none;">
			<table style="margin-top: 16px;">
				<tr>
					<td style="padding-right: 15px;">
						<i class="icon-warning-sign icon-large"></i>
					</td>
					<td>
						This Unmanaged Host will be permanently deleted. This operation cannot be undone. Are you sure?
					</td>
				</tr>
			</table>
		</div>
	</div>
	<div class ="jmFormactions">
		<button type="button" id="start_stop_button" class="splButton-primary">Start Scheduler</button>	
	</div>
	
		<div class="conf-panel">

			<div style="font-size : 19px;">Please choose deployment type :  
			<select id="deploy-dropdown" style="font-size : 15px">
				<option value="VMware" selected>VMware</option>
				<option value="ITSI">ITSI</option>
				<option value="Custom">Custom</option>
			</select></div><br><br>
		
			<h1 style="padding: 0px 0px 0px 0px;font-size : 17px;">Performance parameters</h1>
			<hr width="50%" align="left" color="#fbfbfb" style="opacity: 0.6;"></hr>
			
			<div id="collection-vmware" style="display : block;">
				
				<table>
					<tr>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task</td>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">Interval (In seconds)&nbsp;&nbsp;&nbsp;</td>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">Expiration (In seconds)</td>
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_hostvmperf" class="task-checkbox config_checkbox" type="checkbox"  checked>hostvmperf<sup class="tooltip">?<span class="tooltip-text">Collects performance data of resources such as cpu, memory, storage for Hosts and VMs</span></sup> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
						<td>
							<input id="vmware_hostvmperf_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="180">&nbsp;&nbsp;
						</td>
						<td>
							<input id="vmware_hostvmperf_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="180">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_otherperf" class="task-checkbox config_checkbox" type="checkbox"  checked>otherperf<sup class="tooltip">?<span class="tooltip-text">Collects performance data of resources such as cpu, memory, storage for Clusters and Resource-Pools</span></sup> </td>
						<td>
							<input id="vmware_otherperf_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="2000">
						</td>
						<td>
							<input id="vmware_otherperf_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="1900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_hierarchyinv" class="task-checkbox config_checkbox" type="checkbox"  checked>hierarchyinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data related to hierarchy such as root-object, parent, type etc for Hosts, VMs, Clusters, Resource-Pools</span></sup> </td>

						<td>
							<input id="vmware_hierarchyinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="300">
						</td>
						<td>
							<input id="vmware_hierarchyinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="300">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_hostinv" class="task-checkbox config_checkbox" type="checkbox"  checked>hostinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as hostname, capabilities, datastores etc for Hosts</span></sup> </td>
						<td>
							<input id="vmware_hostinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>
						<td>
							<input id="vmware_hostinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_vminv" class="task-checkbox config_checkbox" type="checkbox"  checked>vminv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as vm-name, datastore, guest-OS etc for VMs</span></sup> </td>

						<td>
							<input id="vmware_vminv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>
						<td>
							<input id="vmware_vminv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_clusterinv" class="task-checkbox config_checkbox" type="checkbox"  checked>clusterinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, host-systems etc for Clusters</span></sup> </td>

						<td>
							<input id="vmware_clusterinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="1800">
						</td>
						<td>
							<input id="vmware_clusterinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="1800">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_datastoreinv" class="task-checkbox config_checkbox" type="checkbox"  checked>datastoreinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, capabilities, storage-capacity etc for Datastore</span></sup> </td>

						<td>
							<input id="vmware_datastoreinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>
						<td>
							<input id="vmware_datastoreinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_rpinv" class="task-checkbox config_checkbox" type="checkbox"  checked>rpinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, resource-allocation, entities etc for Resource-Pool</span></sup> </td>

						<td>
							<input id="vmware_rpinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>
						<td>
							<input id="vmware_rpinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_task" class="task-checkbox config_checkbox" type="checkbox"  checked>task<sup class="tooltip">?<span class="tooltip-text">Collects data related to tasks such as VM-creation,start,stop, snapshots etc performed in vCenter</span></sup> </td>

						<td>
							<input id="vmware_task_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="300">
						</td>
						<td>
							<input id="vmware_task_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="3600">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="vmware_event" class="task-checkbox config_checkbox" type="checkbox"  checked>event<sup class="tooltip">?<span class="tooltip-text">Collects data related to events such as user-session, alarms, network etc of vCenter</span></sup> </td>

						<td>
							<input id="vmware_event_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="300">
						</td>
						<td>
							<input id="vmware_event_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field vmware-textbox" value="3600">
						</td>			
					</tr>
					</div>
					
				</table>
			
				<br><br>
				<h1 style="padding: 0px 0px 0px 0px;font-size : 17px;">Data collection preference</h1>
				<hr width="50%" align="left" color="#fbfbfb" style="opacity: 0.6;"></hr>
				<input id="vmware_instance_host" class="task-checkbox config_checkbox" type="checkbox" >Collect instance level data for hosts<sup class="tooltip">?<span class="tooltip-text">Collects performance data of all instances of resources such as cpu, memory, storage for Hosts</span></sup><br>
				<input id="vmware_instance_vm" class="task-checkbox config_checkbox" type="checkbox" >Collect instance level data for VMs<sup class="tooltip">?<span class="tooltip-text">Collects performance data of all instances of resources such as cpu, memory, storage for VMs</span></sup><br><br>
			</div>


			<div id="collection-itsi" style="display : none;">
			
				<table>
					<tr>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task</td>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">Interval (In seconds)&nbsp;&nbsp;&nbsp;</td>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">Expiration (In seconds)</td>
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_hostvmperf" class="task-checkbox config_checkbox" type="checkbox"  checked>hostvmperf<sup class="tooltip">?<span class="tooltip-text">Collects performance data of resources such as cpu, memory, storage for Hosts and VMs</span></sup> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
						<td>
							<input id="itsi_hostvmperf_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="180">&nbsp;&nbsp;
						</td>
						<td>
							<input id="itsi_hostvmperf_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="180">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_otherperf" class="task-checkbox config_checkbox" type="checkbox" >otherperf<sup class="tooltip">?<span class="tooltip-text">Collects inventory data related to hierarchy such as root-object, parent, type etc for Hosts, VMs, Clusters, Resource-Pools</span></sup> </td>
						<td>
							<input id="itsi_otherperf_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="2000">
						</td>
						<td>
							<input id="itsi_otherperf_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="1900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_hierarchyinv" class="task-checkbox config_checkbox" type="checkbox" >hierarchyinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data related to hierarchy such as root-object, parent, type etc for Hosts, VMs, Clusters, Resource-Pools</span></sup> </td>

						<td>
							<input id="itsi_hierarchyinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="300">
						</td>
						<td>
							<input id="itsi_hierarchyinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="300">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_hostinv" class="task-checkbox config_checkbox" type="checkbox"  checked>hostinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as hostname, capabilities, datastores etc for Hosts</span></sup> </td>
						<td>
							<input id="itsi_hostinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="900">
						</td>
						<td>
							<input id="itsi_hostinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_vminv" class="task-checkbox config_checkbox" type="checkbox"  checked>vminv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as vm-name, datastore, guest-OS etc for VMs</span></sup> </td>

						<td>
							<input id="itsi_vminv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="900">
						</td>
						<td>
							<input id="itsi_vminv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_clusterinv" class="task-checkbox config_checkbox" type="checkbox" >clusterinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, host-systems etc for Clusters</span></sup> </td>

						<td>
							<input id="itsi_clusterinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="1800">
						</td>
						<td>
							<input id="itsi_clusterinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="1800">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_datastoreinv" class="task-checkbox config_checkbox" type="checkbox"  checked>datastoreinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, capabilities, storage-capacity etc for Datastore</span></sup> </td>

						<td>
							<input id="itsi_datastoreinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="900">
						</td>
						<td>
							<input id="itsi_datastoreinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field itsi-textbox" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_rpinv" class="task-checkbox config_checkbox" type="checkbox" >rpinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, resource-allocation, entities etc for Resource-Pool</span></sup> </td>

						<td>
							<input id="itsi_rpinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="900">
						</td>
						<td>
							<input id="itsi_rpinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_task" class="task-checkbox config_checkbox" type="checkbox" >task<sup class="tooltip">?<span class="tooltip-text">Collects data related to tasks such as VM-creation,start,stop, snapshots etc performed in vCenter</span></sup> </td>

						<td>
							<input id="itsi_task_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="300">
						</td>
						<td>
							<input id="itsi_task_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="3600">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="itsi_event" class="task-checkbox config_checkbox" type="checkbox" >event<sup class="tooltip">?<span class="tooltip-text">Collects data related to events such as user-session, alarms, network etc of vCenter</span></sup> </td>

						<td>
							<input id="itsi_event_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="300">
						</td>
						<td>
							<input id="itsi_event_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field" value="3600">
						</td>			
					</tr>
					</div>
					
				</table>
				<br><br>
				<h1 style="padding: 0px 0px 0px 0px;font-size : 17px;">Data collection preference</h1>
				<hr width="50%" align="left" color="#fbfbfb" style="opacity: 0.6;"></hr>
				<input id="itsi_instance_host" class="task-checkbox config_checkbox" type="checkbox"  checked>Collect instance level data for hosts<sup class="tooltip">?<span class="tooltip-text">Collects performance data of all instances of resources such as cpu, memory, storage for Hosts</span></sup><br>
				<input id="itsi_instance_vm" class="task-checkbox config_checkbox" type="checkbox"  checked>Collect instance level data for VMs<sup class="tooltip">?<span class="tooltip-text">Collects performance data of all instances of resources such as cpu, memory, storage for VMs</span></sup><br><br>

			</div>
			
			<div id="collection-custom" style="display : none;">
			
				<p id="custom_validation-tip" style="display : none;"><span class="validation-tip">Invalid input</span></p>
			
				<table>
					<tr>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Task</td>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">Interval (In seconds)&nbsp;&nbsp;&nbsp;</td>
						<td style="font-size : 16px;padding-bottom : 10px;padding-top : 5px;">Expiration (In seconds)</td>
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_hostvmperf" class="custom-inputs config_checkbox" type="checkbox">hostvmperf<sup class="tooltip">?<span class="tooltip-text">Collects performance data of resources such as cpu, memory, storage for Hosts and VMs</span></sup> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </td>
						<td>
							<input id="custom_hostvmperf_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="180">&nbsp;&nbsp;
						</td>
						<td>
							<input id="custom_hostvmperf_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="180">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_otherperf" class="custom-inputs config_checkbox" type="checkbox">otherperf<sup class="tooltip">?<span class="tooltip-text">Collects performance data of resources such as cpu, memory, storage for Clusters and Resource-Pools</span></sup> </td>
						<td>
							<input id="custom_otherperf_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="2000">
						</td>
						<td>
							<input id="custom_otherperf_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="1900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_hierarchyinv" class="custom-inputs config_checkbox" type="checkbox">hierarchyinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data related to hierarchy such as root-object, parent, type etc for Hosts, VMs, Clusters, Resource-Pools</span></sup> </td>

						<td>
							<input id="custom_hierarchyinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="300">
						</td>
						<td>
							<input id="custom_hierarchyinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="300">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_hostinv" class="custom-inputs config_checkbox" type="checkbox">hostinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as hostname, capabilities, datastores etc for Hosts</span></sup> </td>
						<td>
							<input id="custom_hostinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>
						<td>
							<input id="custom_hostinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_vminv" class="custom-inputs config_checkbox" type="checkbox">vminv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as vm-name, datastore, guest-OS etc for VMs</span></sup> </td>

						<td>
							<input id="custom_vminv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>
						<td>
							<input id="custom_vminv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_clusterinv" class="custom-inputs config_checkbox" type="checkbox">clusterinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, host-systems etc for Clusters</span></sup> </td>

						<td>
							<input id="custom_clusterinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="1800">
						</td>
						<td>
							<input id="custom_clusterinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="1800">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_datastoreinv" class="custom-inputs config_checkbox" type="checkbox">datastoreinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, capabilities, storage-capacity etc for Datastore</span></sup> </td>

						<td>
							<input id="custom_datastoreinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>
						<td>
							<input id="custom_datastoreinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_rpinv" class="custom-inputs config_checkbox" type="checkbox">rpinv<sup class="tooltip">?<span class="tooltip-text">Collects inventory data such as name, resource-allocation, entities etc for Resource-Pool</span></sup> </td>

						<td>
							<input id="custom_rpinv_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>
						<td>
							<input id="custom_rpinv_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="900">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_task" class="custom-inputs config_checkbox" type="checkbox">task<sup class="tooltip">?<span class="tooltip-text">Collects data related to tasks such as VM-creation, VM-start, VM-stop, snapshots etc performed in vCenter</span></sup> </td>

						<td>
							<input id="custom_task_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="300">
						</td>
						<td>
							<input id="custom_task_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="3600">
						</td>			
					</tr>
					<tr>
						<td style="cursor: default;"><input id="custom_event" class="custom-inputs config_checkbox" type="checkbox">event<sup class="tooltip">?<span class="tooltip-text">Collects data related to events such as user-session, alarms, network etc of vCenter</span></sup> </td>

						<td>
							<input id="custom_event_interval" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="300">
						</td>
						<td>
							<input id="custom_event_expiration" type="text" class="text ui-widget-content ui-corner-all dialog-field custom-inputs" value="3600">
						</td>			
					</tr>
					</div>
					
				</table>
				<br><br>
				<h1 style="padding: 0px 0px 0px 0px;font-size : 17px;">Data collection preference</h1>
				<hr width="50%" align="left" color="#fbfbfb" style="opacity: 0.6;"></hr>
				<input id="custom_instance_host" class="custom-inputs config_checkbox" type="checkbox">Collect instance level data for hosts<sup class="tooltip">?<span class="tooltip-text">Collects performance data of all instances of resources such as cpu, memory, storage for Hosts</span></sup><br>
				<input id="custom_instance_vm" class="custom-inputs config_checkbox" type="checkbox">Collect instance level data for VMs<sup class="tooltip">?<span class="tooltip-text">Collects performance data of all instances of resources such as cpu, memory, storage for VMs</span></sup><br><br>

			</div>
			<div>
			<div id="vmware-textbox-hostvmperf-div">
			<table>
					<tr>
						<td style="cursor: default;">VM Metric Whitelist<sup class="tooltip">?<span class="tooltip-text">Collects data of VM performance metrics  matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. .*_cpu_.*, .*_net_.* )</span></sup>&nbsp;</td>
						<td>
							<input id="vm_metric_whitelist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
					<tr>
						<td style="cursor: default;">VM Metric Blacklist<sup class="tooltip">?<span class="tooltip-text">Collects data of VM performance metrics not matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. .*mem.*)</span></sup>&nbsp;</td>
						<td>
							<input id="vm_metric_blacklist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
					<tr>
						<td style="cursor: default;">Host Metric Whitelist<sup class="tooltip">?<span class="tooltip-text">Collects data of Host performance metrics matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. ^p_average.*,.*_cpu_.*)</span></sup>&nbsp;</td>
						<td>
							<input id="host_metric_whitelist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
					<tr>
						<td style="cursor: default;">Host Metric Blacklist<sup class="tooltip">?<span class="tooltip-text">Collects data of Host performance metrics not matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. .*_cpu_.*, .*_disk_.*)</span></sup>&nbsp;</td>
						<td>
							<input id="host_metric_blacklist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>
				</table>
				</div>
				<div id="vmware-textbox-otherperf-div">
				<table>
					<tr>
						<td style="cursor: default;">Cluster Metric Whitelist<sup class="tooltip">?<span class="tooltip-text">Collects data of Cluster performance metrics matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. .*_(clusterServices|cpu).*) <br/>(default value is ^p_(?!average_cpu_reservedCapacity_megaHertz).*_(clusterServices|cpu).*)</span></sup>&nbsp;</td>
						<td>
							<input id="cluster_metric_whitelist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
					<tr>
						<td style="cursor: default;">Cluster Metric Blacklist<sup class="tooltip">?<span class="tooltip-text">Collects data of Cluster performance metrics not matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. p_average_cpu_reservedCapacity.*)</span></sup>&nbsp;</td>
						<td>
							<input id="cluster_metric_blacklist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
					<tr>
						<td style="cursor: default;">ResourcePool Metric Whitelist<sup class="tooltip">?<span class="tooltip-text">Collects data of ResourcePool performance metrics matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. .*_cpu_.*)</span></sup>&nbsp;</td>
						<td>
							<input id="rp_metric_whitelist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
					<tr>
						<td style="cursor: default;">ResourcePool Metric Blacklist<sup class="tooltip">?<span class="tooltip-text">Collects data of ResourcePool performance metrics not matched with the regex, by default it will collect all metrics unless specified as regex <br/>(e.g. .*_cpu_.*)</span></sup>&nbsp;</td>
						<td>
							<input id="rp_metric_blacklist" type="text" class="vmware-textbox-mbwl text ui-widget-content ui-corner-all dialog-field" value="">&nbsp;&nbsp;
						</td>
					</tr>				
				</table>
				</div><br><br>
			</div>
			<button id="save-collection" type="button" class="splButton-primary">Save</button>

			<div id="confirm-dialog" class="confirm-style">
				<div class="dialog-content">
					<span class="dialog-close">&times;</span>
										
					<p id="message-text" style="font-size : 14px;"></p>
					
					<hr width="95%" align="center" color="#fbfbfb" style="opacity: 0.3;"></hr>
					
					<button id="confirm-button" class="splButton-primary">Confirm</button>&nbsp;&nbsp;
					<button id="cancel-button" class="splButton-primary">Cancel</button>
				</div>

			</div>

			
		</div>
	
	</div>

	<script>
	// IE9 and IE10 fix
    if(!window.console) {
    	var console = {
        	log : function(){},
        	warn : function(){},
        	error : function(){}
        }
     }
	$(document).ready(function() {
		//Get the data
		<%
			import json
			data_json = json.dumps(conf_data)
		%>
		var server_data = ${data_json | n};
		collection_update();
		var selected_vc_hosts = {"included_hosts": [], "excluded_hosts": []};
		//Utils
		var validation_good_html = "<i class='icon-ok icon-large valid'></i>";
		var validation_bad_html = "<i class='icon-remove icon-large invalid'></i>";
		var validation_working_html = "<i class='icon-refresh icon-spin icon-large' style='color:#373737;'></i>";
		var disabled_html = "<i class='icon-minus icon-large disabled'></i>";
		var node_box_good_html = "<i class='icon-ok-circle valid node-icon'></i>";
		var node_box_bad_html = "<i class='icon-remove-circle invalid node-icon'></i>";
		var $overlay = $("#disable-overlay");
		var $node_container = $("#hydra-node-wrapper");
		var $vc_container = $("#vc-wrapper");
		var $unmanaged_container = $("#unmanaged-wrapper");
		$.ajaxSetup({ cache: false });
		function disableUI() {
			$overlay.width($(document).width());
			$overlay.height($(document).height());
			$overlay.fadeIn();
		};
		function enableUI() {
			$overlay.fadeOut();
		};
		$(window).resize(function() {
			$overlay.width($(document).width());
			$overlay.height($(document).height());
		});
		function updateTips(t, $tips) {
			$tips
				.text( t )
				.addClass( "ui-state-highlight" );
			setTimeout(function() {
				$tips.removeClass( "ui-state-highlight", 1500 );
			}, 500 );
		};
		function checkRegexp( o, regexp, n, $tips) {
			if ( !( regexp.test( o.val() ) ) ) {
				o.addClass( "ui-state-error" );
				updateTips(n, $tips);
				return false;
			} else {
				return true;
			}
		};
		
		
		$("#save-collection").on('click', function() {
			var deployment_type_text = $("#deploy-dropdown").val();
			
			var msg_content;
			var task_array = task_list();
			deploy_type_text = deployment_type_text.toLowerCase();
			var dict_interval = interval_dict();
			var dict_expiration = expiration_dict();
			for(var i=0;i<task_array.length;i++)
			{
				$("#"+deploy_type_text+"_"+task_array[i]+"_interval").removeClass("ui-state-error");
				$("#"+deploy_type_text+"_"+task_array[i]+"_expiration").removeClass("ui-state-error");
			}
			$("#"+deploy_type_text+"_validation-tip").hide();
			
			if(time_valid(deployment_type_text)){
				if(task_array.length>0)
					msg_content = "You have selected deployment-type : "+deployment_type_text+" configuration. Do you want to continue?";
				else
					msg_content = "You have not selected any task. Do you want to continue?";
				
				$("#message-text")[0].innerHTML = msg_content;
				$("#confirm-dialog").show();
			}
		});
		
		function time_valid(deploy_type_text)
		{
			deploy_type_text = deploy_type_text.toLowerCase();
			
			var task_array = task_list();
			if(task_array.length==0)
				return true;
				
			var valid_flag = true;
				
			var dict_interval = interval_dict();
			for(var i=0;i<task_array.length;i++)
				if(!RegExp("^[1-9][0-9]*$").test(dict_interval[task_array[i]+"_interval"]))
				{
					$("#"+deploy_type_text+"_"+task_array[i]+"_interval").addClass("ui-state-error");
					$("#"+deploy_type_text+"_validation-tip").show();
					valid_flag = false;
				}
			
			var dict_expiration = expiration_dict();
			for(var i=0;i<task_array.length;i++)
				if(!RegExp("^[1-9][0-9]*$").test(dict_expiration[task_array[i]+"_expiration"]))
				{
					$("#"+deploy_type_text+"_"+task_array[i]+"_expiration").addClass("ui-state-error");
					$("#"+deploy_type_text+"_validation-tip").show();
					valid_flag =  false;
				}
			
			return valid_flag;
		}

		$(".dialog-close").click(function() {
				$("#confirm-dialog").hide();
		});
		
		$("#cancel-button").click(function() {
				$("#confirm-dialog").hide();
		});
		
		$("#confirm-button").click(function() {
				save_collection_config();
				$("#confirm-dialog").hide();
		});

		$("#deploy-dropdown").change(function(){
			collection_show();			
		});
		
		
		var task_all = ["hostvmperf", "otherperf", "hierarchyinv", "hostinv", "vminv", "clusterinv", "datastoreinv", "rpinv", "task", "event", "instance_host", "instance_vm"];
				
		$(".task-checkbox").change(function()
		{
			var dropdown_text = $("#deploy-dropdown").val();				
			collection_change(dropdown_text);
			$("#deploy-dropdown").val("Custom");
			collection_show();
			this.checked = !(this.checked);
		});
		
		function collection_change(dropdown_text)
		{
			var checkboxid;
			if(dropdown_text==="VMware")
				checkboxid = "vmware";
			else
				checkboxid = "itsi";
			
			for(var i=0;i<12;i++)
				$("#custom_"+task_all[i])[0].checked = $("#"+checkboxid+"_"+task_all[i])[0].checked;
			
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").val($("#"+checkboxid+"_"+task_all[i]+"_interval").val());
				$("#custom_"+task_all[i]+"_expiration").val($("#"+checkboxid+"_"+task_all[i]+"_expiration").val());
			}
			
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").removeClass("ui-state-error");
				$("#custom_"+task_all[i]+"_expiration").removeClass("ui-state-error");
			}
			$("#custom_validation-tip").hide();
		}
		
		$(".vmware-textbox").change(function ()
		{
			var interval_expiration_dict = {	"vmware_hostvmperf_interval": 180, 
												"vmware_otherperf_interval": 2000, 
												"vmware_hierarchyinv_interval": 300, 
												"vmware_hostinv_interval": 900, 
												"vmware_vminv_interval": 900, 
												"vmware_clusterinv_interval": 1800, 
												"vmware_datastoreinv_interval": 900, 
												"vmware_rpinv_interval": 900, 
												"vmware_task_interval": 300, 
												"vmware_event_interval": 300,
												"vmware_hostvmperf_expiration": 180, 
												"vmware_otherperf_expiration": 1900, 
												"vmware_hierarchyinv_expiration": 300, 
												"vmware_hostinv_expiration": 900, 
												"vmware_vminv_expiration": 900, 
												"vmware_clusterinv_expiration": 1800, 
												"vmware_datastoreinv_expiration": 900, 
												"vmware_rpinv_expiration": 900, 
												"vmware_task_expiration": 3600, 
												"vmware_event_expiration": 3600
											};
			
			for(var i=0;i<12;i++)
				$("#custom_"+task_all[i])[0].checked = $("#vmware_"+task_all[i])[0].checked;
			
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").val($("#vmware_"+task_all[i]+"_interval").val());
				$("#custom_"+task_all[i]+"_expiration").val($("#vmware_"+task_all[i]+"_expiration").val());
			}
			
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").removeClass("ui-state-error");
				$("#custom_"+task_all[i]+"_expiration").removeClass("ui-state-error");
			}
			$("#custom_validation-tip").hide();
			
			$("#deploy-dropdown").val("Custom");
			collection_show();
			
			this.value = interval_expiration_dict[this.id];
		});
			
		$(".itsi-textbox").change(function()
		{
			var interval_expiration_dict = {	"itsi_hostvmperf_interval": 180, 
												"itsi_hostinv_interval": 900, 
												"itsi_vminv_interval": 900, 
												"itsi_datastoreinv_interval": 900,
												"itsi_hostvmperf_expiration": 180, 
												"itsi_hostinv_expiration": 900, 
												"itsi_vminv_expiration": 900, 
												"itsi_datastoreinv_expiration": 900
											};
			
			for(var i=0;i<12;i++)
				$("#custom_"+task_all[i])[0].checked = $("#itsi_"+task_all[i])[0].checked;
			
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").val($("#itsi_"+task_all[i]+"_interval").val());
				$("#custom_"+task_all[i]+"_expiration").val($("#itsi_"+task_all[i]+"_expiration").val());
			}
			
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").removeClass("ui-state-error");
				$("#custom_"+task_all[i]+"_expiration").removeClass("ui-state-error");
			}
			$("#custom_validation-tip").hide();
			
			$("#deploy-dropdown").val("Custom");
			collection_show();
			
			this.value = interval_expiration_dict[this.id];
		});
			
		$(".custom-inputs").on('change', function()
		{
			var dropdown_text = "Custom";
			
			if(is_vmware_collection())
				dropdown_text = "VMware";
			else if(is_itsi_collection())
				dropdown_text = "ITSI";
			
			$("#deploy-dropdown").val(dropdown_text);
			collection_show();
		});
		
		function is_vmware_collection()
		{
			
			for(var i=0;i<12;i++)
				if($("#vmware_"+task_all[i])[0].checked != $("#custom_"+task_all[i])[0].checked)
					return false;
			
			for(var i=0;i<10;i++)
			{
				if($("#vmware_"+task_all[i]+"_interval").val() != $("#custom_"+task_all[i]+"_interval").val())
					return false;
				if($("#vmware_"+task_all[i]+"_expiration").val() != $("#custom_"+task_all[i]+"_expiration").val())
					return false;
			}			
			return true;
		}
		
		function is_itsi_collection()
		{
			
			for(var i=0;i<12;i++)
				if($("#itsi_"+task_all[i])[0].checked != $("#custom_"+task_all[i])[0].checked)
					return false;
			
			for(var i=0;i<10;i++)
				if(i==0 || i==3 || i==4 || i==6)
				{
					if($("#itsi_"+task_all[i]+"_interval").val() != $("#custom_"+task_all[i]+"_interval").val())
						return false;
					if($("#itsi_"+task_all[i]+"_expiration").val() != $("#custom_"+task_all[i]+"_expiration").val())
						return false;
				}
					
			return true;
		}
		
		function task_list(){
			
			if ($("#deploy-dropdown").val()==="VMware")
				return ["hostvmperf", "otherperf", "hierarchyinv", "hostinv", "vminv", "clusterinv", "datastoreinv", "rpinv", "task", "event"];
			else if($("#deploy-dropdown").val()==="ITSI")
				return ["hostvmperf", "hostinv", "vminv", "datastoreinv"];
			else
			{
				var task_array =[];
				for(var i=0;i<10;i++)
					if ($("#custom"+"_"+task_all[i])[0].checked)
						task_array.push(task_all[i]);
				
				return task_array;
			}
		}
		
		function interval_dict()
		{
			var dict_interval = {};
			var task_array = task_list();
				
			var textbox_id=$("#deploy-dropdown").val();
			textbox_id = textbox_id.toLowerCase();
			for(var i=0;i<task_array.length;i++)
				dict_interval[task_array[i]+"_interval"] = $("#"+textbox_id+"_"+task_array[i]+"_interval").val();

			return dict_interval;
		}
		
		function expiration_dict()
		{
			var dict_expiration = {};
			var task_array = task_list();
				
			var textbox_id=$("#deploy-dropdown").val();
			textbox_id = textbox_id.toLowerCase();
			for(var i=0;i<task_array.length;i++)
				dict_expiration[task_array[i]+"_expiration"] = $("#"+textbox_id+"_"+task_array[i]+"_expiration").val();

			return dict_expiration;
		}
		
		function collection_instance_dict()
		{
			var dict_collection_instance = {};
				
			var checkboxid=$("#deploy-dropdown").val();
			checkboxid = checkboxid.toLowerCase();
			
			if($("#"+checkboxid+"_instance_host")[0].checked===true)
				dict_collection_instance["host_instance_whitelist"] = 1;
			else
				dict_collection_instance["host_instance_whitelist"] = 0;
			
			if($("#"+checkboxid+"_instance_vm")[0].checked===true)
				dict_collection_instance["vm_instance_whitelist"] = 1;
			else
				dict_collection_instance["vm_instance_whitelist"] = 0;
			
			return dict_collection_instance;
		}

		function collection_metric_dict()
		{
			var dict_collection_metric = {};
			var textbox_id=$("#deploy-dropdown").val();
			textbox_id = textbox_id.toLowerCase();
			if($("#"+textbox_id+"_hostvmperf")[0].checked){
				dict_collection_metric["vm_metric_whitelist"] = $("#vm_metric_whitelist").val().trim().replace(/\s*,\s*/g, ", ");
				dict_collection_metric["vm_metric_blacklist"] = $("#vm_metric_blacklist").val().trim().replace(/\s*,\s*/g, ", ");
				dict_collection_metric["host_metric_whitelist"] = $("#host_metric_whitelist").val().trim().replace(/\s*,\s*/g, ", ");
				dict_collection_metric["host_metric_blacklist"] = $("#host_metric_blacklist").val().trim().replace(/\s*,\s*/g, ", ");
			}
			if($("#"+textbox_id+"_otherperf")[0].checked){
				dict_collection_metric["cluster_metric_whitelist"] = $("#cluster_metric_whitelist").val().trim().replace(/\s*,\s*/g, ", ");
				dict_collection_metric["cluster_metric_blacklist"] = $("#cluster_metric_blacklist").val().trim().replace(/\s*,\s*/g, ", ");
				dict_collection_metric["rp_metric_whitelist"] = $("#rp_metric_whitelist").val().trim().replace(/\s*,\s*/g, ", ");
				dict_collection_metric["rp_metric_blacklist"] = $("#rp_metric_blacklist").val().trim().replace(/\s*,\s*/g, ", ");
			}
			return dict_collection_metric;
		}
		
		function save_collection_config()
		{
			var params = {
				deployment_type: $("#deploy-dropdown").val(),
				task: task_list(),
				interval: JSON.stringify(interval_dict()),
				expiration: JSON.stringify(expiration_dict()),
				collection_instance_list: JSON.stringify(collection_instance_dict()),
				collection_metric_list: JSON.stringify(collection_metric_dict())
			};
			
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'save_collection');
			
			disableUI();
			
			$.ajax({
					type: "POST",
					url:uri,
					data:params,
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						console.log("[custom UI] SUCCESS on custom config save, updating interface...");
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[custom UI] AJAX Failure in save of custom config");
						
					},
					complete: function() {
						console.log("[custom UI] completed save attempt for custom config");
						console.log("[custom UI] updating to latest from server");
						collection_update();
						enableUI();
					}
			});
		}
		
		function collection_update()
		{
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'get_collection');
			
			$.ajax({
					type: "GET",
					url:uri,
					data:{},
					datatype:'json',
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						console.log("[custom UI] SUCCESS on custom config get, updating interface...");
						collection_ui_update(rsp.deployment_type, rsp.task, rsp.interval_list, rsp.expiration_list, rsp.collection_instance_list, rsp.collection_metric_dict);
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[custom UI] AJAX Failure in getting of custom config");
						
					},
					complete: function() {
						console.log("[custom UI] completed update attempt for custom config");
					}
			});
		
		}
		
		function collection_ui_update(deployment_type, task, interval_list, expiration_list, collection_instance_list, collection_metric_dict)
		{
			task_checkbox_array = [false, false, false, false, false, false, false, false, false, false];
			task_dict = {hostvmperf: 0, otherperf: 1, hierarchyinv: 2, hostinv: 3, vminv: 4, clusterinv: 5, datastoreinv: 6, rpinv: 7, task: 8, event: 9};
			
			for(var i=0;i<task.length;i++)
				task_checkbox_array[task_dict[task[i]]] = true;

			for(var i=0;i<10;i++)	
				$("#custom_"+task_all[i])[0].checked = task_checkbox_array[i];
				
			for(var i=0;i<10;i++)
			{
				$("#custom_"+task_all[i]+"_interval").val(interval_list[i]);
				$("#custom_"+task_all[i]+"_expiration").val(expiration_list[i]);
			}
			for(var key in collection_metric_dict)
			{
				$("#"+key).val(collection_metric_dict[key]);
			}

			$("#custom_instance_host")[0].checked = (collection_instance_list[0]=="true");
			$("#custom_instance_vm")[0].checked = (collection_instance_list[1]=="true");
			
			var dropdown_text = "Custom";
			
			if(is_vmware_collection()){
				dropdown_text = "VMware";
				custom_reset();
			}
			else if(is_itsi_collection()){
				dropdown_text = "ITSI";
				custom_reset();
			}
			
			$("#deploy-dropdown").val(dropdown_text);
			collection_show();
		}
		
		function custom_reset()
		{
			for(var i=0;i<12;i++)
				$("#custom_"+task_all[i])[0].checked = false;
		}
		
		function collection_show(){
			if( $('#deploy-dropdown').val() === 'VMware' ){
				$('#collection-vmware').show();
				$('#collection-itsi').hide();
				$('#collection-custom').hide();
				$('#vmware-textbox-hostvmperf-div').show();
				$('#vmware-textbox-otherperf-div').show();
			}
			else if( $('#deploy-dropdown').val() === 'ITSI' ){
				$('#collection-vmware').hide();
				$('#collection-itsi').show();
				$('#collection-custom').hide();
				$('#vmware-textbox-hostvmperf-div').show();
				$('#vmware-textbox-otherperf-div').hide();
			}
			else{
				$('#collection-vmware').hide();
				$('#collection-itsi').hide();
				$('#collection-custom').show();
				if($("#custom_hostvmperf")[0].checked===true){
					$("#vmware-textbox-hostvmperf-div").show();
				}else{
					$("#vmware-textbox-hostvmperf-div").hide();
				}	
				if($("#custom_otherperf")[0].checked===true){
					$("#vmware-textbox-otherperf-div").show();
				}else{
					$("#vmware-textbox-otherperf-div").hide();
				}
			}
		}
		
		
		function updateConfData(no_info, complete_fun) {
			/*args:
			 * no_info - pass true to avoid updating the info box
			 * complete_fun - pass a function to run after the update is complete
			 */
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'conf_data');
			$.ajax({
				type: "GET",
				url:uri,
				data:{},
				datatype:'json',
				beforeSend: function(xhr) {
					xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
				},
				success: function(rsp) {
					console.log("[splunk_for_vmware_setup] updated conf data with latest from server");
					server_data = rsp;
					console.log("[splunk_for_vmware_setup] updating collection node interface");
					updateCollectionButton();
					updateHydraNodeBar();
					if (no_info != true) {
						updateHydraNodeInfoBox();
					}
					console.log("[splunk_for_vmware_setup] updating vc interface");
					updateVCNodeBar();
					if (no_info != true) {
						updateVCInfoBox();
					}
					console.log("[splunk_for_vmware_setup] unmanaged interface disabled");
					//updateUnmanagedNodeBar();
					if (no_info != true) {
						//updateUnmanagedInfoBox();
					}
				},
				error: function(jqXHR,textStatus,errorThrown) {
					console.log("[splunk_for_vmware_setup] AJAX Failure on getting updated conf data");
				},
				complete: function() {
					enableUI();
					if (complete_fun) {
						complete_fun();
					}
				}
			});
		};
		//Client Side Rendering Logic
		//Make the hydra node interface
		function updateHydraNodeBar() {
			//Bind that data!
			var container = d3.select("#hydra-node-nodebar-container");
			var node_boxes = container.selectAll("div.node-box")
				.data(server_data.nodes, function(d) { return d.host_path; });
			
			//Make the new guys
			node_boxes.enter()
				.append("div")
				.on("click", function() {
					d3.select("#hydra-node-nodebar-container").selectAll("div.node-box.selected").classed("selected", false);
					d3.select(this).classed("selected", true);
					updateHydraNodeInfoBox();
				});
			
			//Update everybody
			node_boxes.classed("node-box", true)
				.classed("valid", function(d) {
					var d3this = d3.select(this);
					if (d.credential_validation && d.addon_validation) {
						d3this.html(node_box_good_html);
						return true
					}
					else {
						d3this.html(node_box_bad_html);
						return false
					}
				});
			
			//Delete the old guys
			node_boxes.exit().remove();
			
			//set the first one to be the selected one if none selected
			var selected_node = d3.select("#hydra-node-nodebar-container").select(".node-box.selected");
			if (selected_node.empty()) {
				d3.select("#hydra-node-nodebar-container").select("div.node-box").classed("selected", true);
			}
		};
		
		function updateHydraNodeInfoBox() {
			var selected_node = d3.select("#hydra-node-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				//We have something selected so let's populate the info box, with jquery, cuz we crazy like that
				var data = selected_node.data()[0];
				var $info_container = $("#selected-hydra-node-info");
				//Basic Information
				$(".selected-name", $info_container).html(data.host_path);
				$("td.selected-username", $info_container).html(data.username);
				$("td.selected-heads", $info_container).html(data.heads);
				//Validation Information
				$(".selected-cred-validated", $info_container).html(data.credential_validation ? validation_good_html : validation_bad_html);
				$(".selected-addon-validated", $info_container).html(data.addon_validation ? validation_good_html : validation_bad_html);
				$(".selected-cred-msg", $info_container).html("");
				$(".selected-addon-msg", $info_container).html("");
				//Call validate action
				$("#selected-hydra-node-validate", $node_container).click();
			}
			else {
				//Basic Information
				$(".selected-name", $info_container).html("please select a collection node...");
				$("td.selected-username", $info_container).html("please select a collection node...");
				$("td.selected-heads", $info_container).html("please select a collection node...");
				//Validation Information
				$(".selected-cred-validated", $info_container).html("please select a collection node...");
				$(".selected-addon-validated", $info_container).html("please select a collection node...");
				$(".selected-cred-msg", $info_container).html("");
				$(".selected-addon-msg", $info_container).html("");
				console.log("No hydra node selected cannot display anything");
			}
		};
		//Make the VC interface
		function updateVCNodeBar() {
			//Bind that data!
			var container = d3.select("#vc-nodebar-container");
			var node_boxes = container.selectAll("div.node-box")
				.data(server_data.vcenters, function(d) { return d.target; });
			
			//Make the new guys
			node_boxes.enter()
				.append("div")
				.on("click", function() {
					d3.select("#vc-nodebar-container").selectAll("div.node-box.selected").classed("selected", false);
					d3.select(this).classed("selected", true);
					console.log("CLICKED ON A VCENTER");
					updateVCInfoBox();
				});
			
			//Update everybody
			node_boxes.classed("node-box", true)
				.classed("valid", function(d) {
					var d3this = d3.select(this);
					// consider VC splunk fowarder validation when "Collect VC Logs" is checked
					if(d.vc_collect_logs)
						vc_validation = d.credential_validation && d.forwarder_credential_validation && d.forwarder_addon_validation;	
					else
						vc_validation = d.credential_validation;
					
					if (vc_validation) {
						d3this.html(node_box_good_html);
						return true
					}
					else {
						d3this.html(node_box_bad_html);
						return false
					}
				
				});
			
			//Delete the old guys
			node_boxes.exit().remove();
			
			//Select one if none selected
			var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
			if (selected_node.empty()) {
				d3.select("#vc-nodebar-container").select("div.node-box").classed("selected", true);
			}
		};
		
		function updateVCHosts(stanza_name) {
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'get_managed_hosts');
			var $info_container = $("#selected-vc-info");
			var $hosts_val_td = $("#selected-vc-hosts");
			var $hosts_msg_td =$("td.selected-vc-msg");
			$hosts_msg_td.html(validation_working_html);
			$hosts_val_td.hide();
			$hosts_msg_td.show();
			$.ajax({
					type: "GET",
					url:uri,
					data:{vc: $.trim(stanza_name)},
					datatype:'json',
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp, status) {
						console.log("[splunk_for_vmware_setup] SUCCESS on vcenter managed host acquizition, updating interface...");
						selected_vc_hosts = rsp;
						var include_count = rsp.included_hosts.length;
						$hosts_msg_td.html("");
						$hosts_msg_td.hide();
						$hosts_val_td.html("<a class='clickable'><span>" + String(include_count) + " hosts</span><i class='icon-search conf-icon' style='padding-left: 10px;'></i></a>");
						$hosts_val_td.show();
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure in managed host get for vcenter");
						$hosts_val_td.html(validation_bad_html);
						$hosts_val_td.show();
						$hosts_msg_td.html("<span class='invalid'>Error getting host list from server")
						$hosts_msg_td.show();
					},
					complete: function() {
						console.log("[splunk_for_vmware_setup] completed managed host attempt for vcenter");
					}
			});
		};
		
		function updateVCInfoBox() {
			console.log("UPDATING VC INFO BOX");
			var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				//We have something selected so let's populate the info box, with jquery, cuz we crazy like that
				var data = selected_node.data()[0];
				var $info_container = $("#selected-vc-info");
				var vc = $.trim(data.target);
				//Basic Information
				$(".selected-name", $info_container).html(vc);
				$("td.selected-username", $info_container).html($.trim(data.username));
				//Validation Information
				$(".selected-cred-validated", $info_container).html(data.credential_validation ? validation_good_html : validation_bad_html);
				$(".selected-cred-msg", $info_container).html("");
				
				if(data.vc_collect_logs){
					$(".vclog_info_row", $info_container).show();
					$(".selected-vclog-validated", $info_container).html(data.forwarder_credential_validation ? validation_good_html : validation_bad_html );
					$(".selected-vclog-addon-validated", $info_container).html(data.forwarder_addon_validation ? validation_good_html : validation_bad_html );
				}
				else
					$(".vclog_info_row", $info_container).hide();
				//Call Validate
				validateVC();
				$("#selected-vc-validate", $info_container).click();
				//Populate host list information
				updateVCHosts($.trim(data.stanza_name));
			}
			else {
				//Basic Information
				var $info_container = $("#selected-vc-info");
				$(".selected-name", $info_container).html("please select a vc...");
				$("td.selected-username", $info_container).html("please select a vc...");
				//Validation Information
				$(".selected-cred-validated", $info_container).html("please select a vc...");
				$(".selected-cred-msg", $info_container).html("");
				$(".selected-vclog-validated", $info_container).html("please select a vc...");
				$(".selected-vclog-msg", $info_container).html("");
				$(".selected-vclog-addon-validated", $info_container).html("please select a vc...");
				$(".selected-vclog-addon-msg", $info_container).html("");								
				//Populate host list information
				$("td.selected-host-list", $info_container).html("please select a vc...");
				console.log("No vc selected cannot display anything");
			}
		};
		
		//Make the unmanaged host interface
		function updateUnmanagedNodeBar() {
			//Bind that data!
			var container = d3.select("#unmanaged-nodebar-container");
			var node_boxes = container.selectAll("div.node-box")
				.data(server_data.unmanaged_hosts, function(d) { return d.target; });
			
			//Make the new guys
			node_boxes.enter()
				.append("div")
				.on("click", function() {
					d3.select("#unmanaged-nodebar-container").selectAll("div.node-box.selected").classed("selected", false);
					d3.select(this).classed("selected", true);
					updateUnmanagedInfoBox();
				});
			
			//Update everybody
			node_boxes.classed("node-box", true)
				.classed("valid", function(d) {
					var d3this = d3.select(this);
					if (d.credential_validation) {
						d3this.html(node_box_good_html);
						return true
					}
					else {
						d3this.html(node_box_bad_html);
						return false
					}
				});
			
			//Delete the old guys
			node_boxes.exit().remove();
			
			//Select one if none selected
			var selected_node = d3.select("#unmanaged-nodebar-container").select(".node-box.selected");
			if (selected_node.empty()) {
				d3.select("#unmanaged-nodebar-container").select("div.node-box").classed("selected", true);
			}
		};
		function updateUnmanagedInfoBox() {
			var selected_node = d3.select("#unmanaged-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				//We have something selected so let's populate the info box, with jquery, cuz we crazy like that
				var data = selected_node.data()[0];
				var $info_container = $("#selected-unmanaged-info");
				//Basic Information
				$(".selected-name", $info_container).html(data.target);
				$("td.selected-username", $info_container).html(data.username);
				//Validation Information
				$(".selected-cred-validated", $info_container).html(data.credential_validation ? validation_good_html : validation_bad_html);
				$(".selected-cred-msg", $info_container).html("");
				//Call Validate
				$("#selected-unmanaged-validate", $unmanaged_container).click();
			}
			else {
				//Populate host list information
				console.log("No unmanaged host selected cannot display anything");
				var $info_container = $("#selected-unmanaged-info");
				//Basic Information
				$(".selected-name", $info_container).html("please select an unmanaged host...");
				$("td.selected-username", $info_container).html("please select an unmanaged host...");
				//Validation Information
				$(".selected-cred-validated", $info_container).html("please select an unmanaged host...");
				$(".selected-cred-msg", $info_container).html("");
			}
		};
		
		//VALIDATION LOGIC
		function validateHydraNode() {
			var selected_node = d3.select("#hydra-node-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'validate_collection_node');
				var params = {
					node : $.trim(data.host_path)
				};
				var $icon = $(this).addClass("icon-spin");
				var $info_container = $("#selected-hydra-node-info");
				$(".selected-cred-validated", $info_container).html(validation_working_html);
				$(".selected-addon-validated", $info_container).html(validation_working_html);
				$.ajax({
					type: "GET",
					url:uri,
					data:params,
					datatype:'json',
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						if (d3.select("#hydra-node-nodebar-container").select(".node-box.selected").data()[0].host_path == params.node) {
							if (rsp.status == "valid") {
								$(".selected-cred-validated", $info_container).html(validation_good_html);
								$(".selected-addon-validated", $info_container).html(validation_good_html);
								$(".selected-cred-msg", $info_container).html("");
								$(".selected-addon-msg", $info_container).html("");
							}
							else if (rsp.status == "invalid") {
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html(rsp.msg);
								$(".selected-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-addon-msg", $info_container).html(rsp.msg);								
							}
							else if (rsp.status == "badapps") {
								$(".selected-cred-validated", $info_container).html(validation_good_html);
								$(".selected-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html("");
								$(".selected-addon-msg", $info_container).html(rsp.msg);
							}
							else if (rsp.status == "unreachable") {
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html(rsp.msg);
								$(".selected-addon-msg", $info_container).html(rsp.msg);
							}
							else {
								console.log("Unexpected response from splunk:");
								console.log(rsp);
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html("ERROR");
								$(".selected-addon-msg", $info_container).html("ERROR");
							}
						}
						updateConfData(true);
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure");
					},
					complete: function() {
						$icon.removeClass("icon-spin");
					}
				})
			}
			else {
				console.log("No hydra node selected cannot validate nothing!");
			}
		};
	
		function validateVCSplunkForwarder() {
			var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'validate_vcenter_forwarder');
				var params = {
					vc : $.trim(data.target),
					name : $.trim(data.stanza_name),
					host_path : $.trim(data.forwarder_uri),
					username : $.trim(data.forwarder_username)
					
				};
				var $icon = $(this).addClass("icon-spin");
				var $info_container = $("#selected-vc-info");
				$(".selected-vclog-validated", $info_container).html(validation_working_html);
				$(".selected-vclog-msg", $info_container).html("");
				$(".selected-vclog-addon-validated", $info_container).html(validation_working_html);
				$(".selected-vclog-addon-msg", $info_container).html("");
				$.ajax({
					type: "GET",
					url:uri,
					data:params,
					datatype:'json',
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						if (d3.select("#vc-nodebar-container").select(".node-box.selected").data()[0].target == params.vc) {
							if (rsp.status == "valid") {
								$(".selected-vclog-validated", $info_container).html(validation_good_html);
								$(".selected-vclog-msg", $info_container).html("");
								$(".selected-vclog-addon-validated", $info_container).html(validation_good_html);
								$(".selected-vclog-addon-msg", $info_container).html("");								
							}
							else if (rsp.status == "invalid") {
								$(".selected-vclog-validated", $info_container).html(validation_bad_html);
								$(".selected-vclog-msg", $info_container).html(rsp.msg);
								$(".selected-vclog-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-vclog-addon-msg", $info_container).html(rsp.msg);								
							}
							else if (rsp.status == "unreachable") {
								$(".selected-vclog-validated", $info_container).html(validation_bad_html);
								$(".selected-vclog-msg", $info_container).html(rsp.msg);
								$(".selected-vclog-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-vclog-addon-msg", $info_container).html(rsp.msg);								
							}
							else {
								console.log("Unexpected response from splunk:");
								console.log(rsp);
								$(".selected-vclog-validated", $info_container).html(validation_bad_html);
								$(".selected-vclog-msg", $info_container).html("ERROR");
								$(".selected-vclog-addon-validated", $info_container).html(validation_bad_html);
								$(".selected-vclog-addon-msg", $info_container).html("ERROR");								
							}
						}
						updateConfData(true);
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure");
					},
					complete: function() {
						$icon.removeClass("icon-spin");
					}
				})
			}
			else {
				console.log("No vc selected cannot validate nothing!");
			}
		};
				
		function validateVC() {
			var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'validate_vcenter');
				var params = {
					vc : $.trim(data.target),
					name : $.trim(data.stanza_name),
					vc_collect_logs : data.vc_collect_logs
				};
				var $icon = $(this).addClass("icon-spin");
				var $info_container = $("#selected-vc-info");
				$(".selected-cred-validated", $info_container).html(validation_working_html);
				console.log("validateVC called");
				$.ajax({
					type: "GET",
					url:uri,
					data:params,
					datatype:'json',
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						if (d3.select("#vc-nodebar-container").select(".node-box.selected").data()[0].target == params.vc) {
							if (rsp.status == "valid") {
								$(".selected-cred-validated", $info_container).html(validation_good_html);
								$(".selected-cred-msg", $info_container).html("");
							}
							else if (rsp.status == "invalid") {
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html(rsp.msg);
							}
							else if (rsp.status == "unreachable") {
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html(rsp.msg);
							}
							else {
								console.log("Unexpected response from splunk:");
								console.log(rsp);
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html("ERROR");
							}
						}
						updateConfData(true);
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure");
					},
					complete: function() {
						$icon.removeClass("icon-spin");
					}
				})
			}
			else {
				console.log("No vc selected cannot validate nothing!");
			}
			if(data.vc_collect_logs){
				validateVCSplunkForwarder();
			}
		};
		

		function validateUnmanaged() {
			var selected_node = d3.select("#unmanaged-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'validate_unmanaged_host');
				var params = {
					host : $.trim(data.target),
					name : $.trim(data.stanza_name)
				};
				var $icon = $(this).addClass("icon-spin");
				var $info_container = $("#selected-unmanaged-info");
				$(".selected-cred-validated", $info_container).html(validation_working_html);
				$.ajax({
					type: "GET",
					url:uri,
					data:params,
					datatype:'json',
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						if (d3.select("#unmanaged-nodebar-container").select(".node-box.selected").data()[0].target == params.host) {
							if (rsp.status == "valid") {
								$(".selected-cred-validated", $info_container).html(validation_good_html);
								$(".selected-cred-msg", $info_container).html("");
							}
							else if (rsp.status == "invalid") {
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html(rsp.msg);
							}
							else if (rsp.status == "unreachable") {
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html(rsp.msg);
							}
							else {
								console.log("Unexpected response from splunk:");
								console.log(rsp);
								$(".selected-cred-validated", $info_container).html(validation_bad_html);
								$(".selected-cred-msg", $info_container).html("ERROR");
							}
						}
						updateConfData(true);
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure");
					},
					complete: function() {
						$icon.removeClass("icon-spin");
					}
				})
			}
			else {
				console.log("No unmanaged selected cannot validate nothing!");
			}
		};
		//EDIT LOGIC
		function saveHydraNode(params) {
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'save_collection_node');
			if (params.node_name.length == 0) {
				delete params.node_name;
			}
			if (params.password.length == 0) {
				delete params.password;
			}
			disableUI();
			$.ajax({
					type: "POST",
					url:uri,
					data:params,
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp, status) {
						console.log("[splunk_for_vmware_setup] SUCCESS on hydra node save, updating interface...");
						updateConfData(true, function() {
							d3.select("#hydra-node-nodebar-container").selectAll("div.node-box")
								.each(function(d) {
									if (d.host_path == params.node) {
										d3.select(this).classed("selected", true);
									}
									else {
										d3.select(this).classed("selected", false);
									}
								});
							updateHydraNodeInfoBox();
						});
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure in save of hydra collection node");
					},
					complete: function() {
						console.log("[splunk_for_vmware_setup] completed save attempt for hydra collection node");
					}
			});
		};

		function saveVC(params) {
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'save_vcenter');
			if (params.password.length == 0) {
				delete params.password;
			}
			if (params.host_whitelist.length == 0) {
				delete params.host_whitelist;
			}
			if (params.host_blacklist.length == 0) {
				delete params.host_blacklist;
			}
			disableUI();
			$.ajax({
					type: "POST",
					url:uri,
					data:params,
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp, status) {
						console.log("[splunk_for_vmware_setup] SUCCESS on vcenter save, updating interface...");
						updateConfData(true, function() {
							d3.select("#vc-nodebar-container").selectAll("div.node-box")
								.each(function(d) {
									if (d.target == params.vc) {
										d3.select(this).classed("selected", true);
									}
									else {
										d3.select(this).classed("selected", false);
									}
								});
							updateVCInfoBox();
						});
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure in save of vcenter");
					},
					complete: function() {
						updateConfData(true);
						console.log("[splunk_for_vmware_setup] completed save attempt for vcenter");
					}
			});
		};
		function updateCollectionButton(){
			if (server_data["isSchedulerDisabled"])
				$("button#start_stop_button").html("Start Scheduler")
			else
				$("button#start_stop_button").html("Stop Scheduler")	
				
		};
		function updateCollection(){
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'update_collection');
			$.ajax({
					type: "GET",
					url:uri,
					//data:params,
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp) {
						console.log("[splunk_for_vmware_setup] SUCCESS on updating collection");
						updateConfData(true);
						updateCollectionButton();
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure while updating data collection status");
					},
					complete: function() {
						console.log("[splunk_for_vmware_setup] completed updating data collection status");
					}

			});
		};
		
		function saveUnmanaged(params) {
			var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'save_unmanaged_host');
			if (params.password.length == 0) {
				delete params.password;
			}
			disableUI();
			$.ajax({
					type: "POST",
					url:uri,
					data:params,
					beforeSend: function(xhr) {
						xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
					},
					success: function(rsp, status) {
						console.log("[splunk_for_vmware_setup] SUCCESS on unmanaged host save, updating interface...");
						updateConfData(true, function() {
							d3.select("#unmanaged-nodebar-container").selectAll("div.node-box")
								.each(function(d) {
									if (d.target == params.host) {
										d3.select(this).classed("selected", true);
									}
									else {
										d3.select(this).classed("selected", false);
									}
								});
							updateUnmanagedInfoBox();
						});
					},
					error: function(jqXHR,textStatus,errorThrown) {
						console.log("[splunk_for_vmware_setup] AJAX Failure in save of unmanaged");
					},
					complete: function() {
						console.log("[splunk_for_vmware_setup] completed save attempt for unmanaged");
					}
			});
		};
		//CRUD binding for collection nodes
		var $hydra_node_dialog = $("#hydra-node-dialog");
		var $hydra_node_tips = $("p.validate-tips", $hydra_node_dialog);
		$hydra_node_dialog.dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			height: 350,
			width: 480,
			modal: true,
			buttons: {
				Cancel: {
					class: 'left-button',
					text: 'Cancel',
					click: function() {
						$(".dialog-field", $hydra_node_dialog).removeClass( "ui-state-error" );
						$( this ).dialog( "close" );
					}
				},
				"Save": {
					class: 'right-button',
					text: 'Save',
					click: function() {
						var validation = true;
						$(".dialog-field", $hydra_node_dialog).removeClass( "ui-state-error" );
						
						validation = validation && checkRegexp( $('#dialog-node-path', $hydra_node_dialog), /^\s*https?:\/\/[A-Za-z0-9\.\-_]+:\d+\/?\s*$/, "You must specify protocol, address, and port for a management uri", $hydra_node_tips);
						validation = validation && checkRegexp( $('#dialog-node-username', $hydra_node_dialog), /./, "You must specify a username", $hydra_node_tips) && checkRegexp( $('#dialog-node-username', $hydra_node_dialog), /^[^\r\n\t\/\s]*$/, "You must specify a valid username", $hydra_node_tips);
						validation = validation && checkRegexp( $('#dialog-node-password', $hydra_node_dialog), /./, "You must specify a password", $hydra_node_tips);
						validation = validation && checkRegexp( $('#dialog-node-heads', $hydra_node_dialog), /^(([1-2][0-9])|[1-9]|30)$/, "You must specify a number of worker processes from 1 to 30", $hydra_node_tips);
						if ( validation ) {
							var password = $("#dialog-node-password", $hydra_node_dialog).val();
							//if password is the default we set it to empty string to indicate no change
							password = password == "$$$$$$$$" ? "" : password;
							var params = {
								node_name: $.trim($("#dialog-node-name", $hydra_node_dialog).val()),
								node: $.trim($("#dialog-node-path", $hydra_node_dialog).val()),
								username: $.trim($("#dialog-node-username", $hydra_node_dialog).val()),
								password: password,
								heads: $("#dialog-node-heads", $hydra_node_dialog).val()
							};
							saveHydraNode(params);
							$( this ).dialog( "close" );
						}
					}
				}
			},
			close: function() {
					$(".dialog-field", $hydra_node_dialog).val( "" ).removeClass( "ui-state-error" );
				}
		});
		$("#selected-node-edit").click( function() {
			//Populate the dialog from selected node
			var selected_node = d3.select("#hydra-node-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				$("#dialog-node-name", $hydra_node_dialog).val($.trim(data.host_path));
				$("#dialog-node-path", $hydra_node_dialog).val($.trim(data.host_path));
				$("#dialog-node-username", $hydra_node_dialog).val($('<div/>').html($.trim(data.username)).text());
				//Set the password to 8 dollar signs to show that this node exists and password can be edited
				$("#dialog-node-password", $hydra_node_dialog).val("$$$$$$$$");
				$("#dialog-node-heads", $hydra_node_dialog).val(data.heads);
				//Set title to edit one
				$hydra_node_dialog.dialog("option", "title", "Edit Data Collection Node");
			}
			else {
				//Set 'em blank
				$("#dialog-node-name", $hydra_node_dialog).val("");
				$("#dialog-node-path", $hydra_node_dialog).val("");
				$("#dialog-node-username", $hydra_node_dialog).val("");
				$("#dialog-node-password", $hydra_node_dialog).val("");
				$("#dialog-node-heads", $hydra_node_dialog).val("");
				//Set title to creating new one
				$hydra_node_dialog.dialog("option", "title", "Create New Collection Node");
			}
			$hydra_node_tips.html("");
			$hydra_node_dialog.dialog("open");
		});
		$("#hydra-node-add").click( function() {
			//Set dialog blank
			$("#dialog-node-name", $hydra_node_dialog).val("");
			$("#dialog-node-path", $hydra_node_dialog).val("");
			$("#dialog-node-username", $hydra_node_dialog).val("");
			$("#dialog-node-password", $hydra_node_dialog).val("");
			$("#dialog-node-heads", $hydra_node_dialog).val("");
			//Set title to creating new one
			$hydra_node_dialog.dialog("option", "title", "Create New Collection Node");
			$hydra_node_tips.html("");
			$hydra_node_dialog.dialog("open");
		});
		var $hydra_node_delete_dialog = $( "#hydra-node-delete-confirm-dialog" ).dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			resizable: false,
			height: 200,
			width: 400,
			modal: true,
			buttons: {
				Cancel: {
					class: 'left-button',
					text: 'Cancel',
					click: function() {
						$( this ).dialog( "close" );
					}
				},
				"Delete Node": {
					class: 'right-button',
					text: 'Delete Node',
					click: function() {
						var selected_node = d3.select("#hydra-node-nodebar-container").select(".node-box.selected");
						if (!selected_node.empty()) {
							var data = selected_node.data()[0];
							var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'delete_collection_node', encodeURIComponent($.trim(data.host_path)));
							disableUI();
							$.ajax({
								type: "DELETE",
								url:uri,
								beforeSend: function(xhr) {
									xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
								},
								success: function(rsp) {
									console.log("[splunk_for_vmware_setup] deleted node " + data.host_path);
									updateConfData();
								},
								error: function(jqXHR,textStatus,errorThrown) {
									console.log("[splunk_for_vmware_setup] AJAX Failure in deletion of node");
								},
							});
						}
						else {
							console.log("[splunk_for_vmware_setup] cannot delete a node when none are selected, please select a node to delete first.");
						}
						$( this ).dialog( "close" );
					}
				}
			}
		});
		$("#hydra-node-delete").click( function() {
			$hydra_node_delete_dialog.dialog("open");
		});
		$("button#start_stop_button").click(function(){
	//			$("button#start_stop_button").html("clicked");
			updateCollection();
		});
		//CRUD bindings for vcenters
		var $vc_hosts_dialog = $("#vc-hosts-dialog");
		$vc_hosts_dialog.dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			height: 400,
			width: 600,
			modal: true,
			buttons: {
				"Close": {
					class: 'right-button',
					text: 'Close',
					click: function() {
						$( this ).dialog( "close" );
					}
				}
			},
			close: function() {
				console.log("[dialog] Close called on host list dialog");
			}
		});
		var $vc_dialog = $("#vc-dialog");
		var $vc_tips = $("p.validate-tips", $vc_dialog);
		//Checkbox functionality on the dialog
		$("#dialog-vc-collect-all-hosts", $vc_dialog).click(function() {
			if (this.checked) {
				$(".dialog-vc-host-options", $vc_dialog).hide();
			}
			else {
				$(".dialog-vc-host-options", $vc_dialog).show();
			}
		});
		$("#dialog-vc-collect-logs", $vc_dialog).click(function() {
			if (this.checked) {
				$(".dialog-vc-log-options", $vc_dialog).show();
			}
			else {
				$(".dialog-vc-log-options", $vc_dialog).hide();
			}
		});	
		$vc_dialog.dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			height: 450,
			width: 580,
			modal: true,
			buttons: {
				Cancel: {
					class: 'left-button',
					text: 'Cancel',
					click: function() {
						$(".dialog-field", $vc_dialog).removeClass( "ui-state-error" );
						$( this ).dialog( "close" );
					}
				},
				"Save": {
					class: 'right-button',
					text: 'Save',
					click: function() {
						var validation = true;
						$(".dialog-field", $vc_dialog).removeClass( "ui-state-error" );
						
						validation = validation && checkRegexp( $('#dialog-vc-path', $vc_dialog), /^[A-Za-z0-9\.\-_]+$/, "You must specify a valid virtual center domain", $vc_tips);
						validation = validation && checkRegexp( $('#dialog-vc-username', $vc_dialog), /[A-Za-z0-9\.\-_]/, "You must specify a username", $vc_tips) && checkRegexp( $('#dialog-vc-username', $vc_dialog), /^[^\r\n\t<>&]*$/, "You must specify a valid username", $vc_tips);
						validation = validation && checkRegexp( $('#dialog-vc-password', $vc_dialog), /./, "You must specify a password", $vc_tips);
						var vc_splunk_uri;
						var vc_splunk_username;
						var vc_splunk_password;
				
						if ($("#dialog-vc-collect-logs", $vc_dialog).prop("checked")) {
							vc_splunk_uri = $.trim($("#dialog-vc-splunk-uri", $vc_dialog).val());
							vc_splunk_username = $.trim($("#dialog-vc-splunk-username", $vc_dialog).val());
							vc_splunk_password = $("#dialog-vc-splunk-password", $vc_dialog).val();
							validation = validation && checkRegexp( $("#dialog-vc-splunk-uri", $vc_dialog), /^\s*https?:\/\/[A-Za-z0-9\.\-_]+:\d+\/?\s*$/, "You must specify protocol, address, and port for a management uri", $vc_tips);
							validation = validation && checkRegexp( $("#dialog-vc-splunk-username", $vc_dialog), /./, "You must specify a splunk username for your vc forwarder to get logs", $vc_tips) && checkRegexp( $("#dialog-vc-splunk-username", $vc_dialog), /^[^\r\n\t]*$/, "You must specify a valid splunk username for your vc forwarder to get logs", $vc_tips);
							validation = validation && checkRegexp( $("#dialog-vc-splunk-password", $vc_dialog), /./, "You must specify a password for the splunk user on your vc forwarder to get logs", $vc_tips);
							//if password is the default we set it to empty string to indicate no change
							vc_splunk_password = vc_splunk_password == "$$$$$$$$" ? "" : vc_splunk_password;
						}
						if ( validation ) {
							//Handle different host list behavior
							var host_whitelist;
							var host_blacklist;
							if ($("#dialog-vc-collect-all-hosts", $vc_dialog).prop("checked")) {
								host_whitelist = "";
								host_blacklist = "";
							}
							else {
								host_whitelist = $("#dialog-vc-host-whitelist", $vc_dialog).val();
								host_blacklist = $("#dialog-vc-host-blacklist", $vc_dialog).val();
							}
							var password = $("#dialog-vc-password", $vc_dialog).val();
							var vc_collect_logs =$("#dialog-vc-collect-logs", $vc_dialog).prop("checked");
							vc_collect_logs = vc_collect_logs == true ? 1:0;
							//if password is the default we set it to empty string to indicate no change
							password = password == "$$$$$$$$" ? "" : password;
							var params = {
								name: $.trim($("#dialog-vc-name", $vc_dialog).val()),
								// Need to set in lower case as we do create tsidx namespace in lower case only
								// SOLNVMW-3550
								vc: $.trim($("#dialog-vc-path", $vc_dialog).val().toLowerCase()),
								username: $.trim($("#dialog-vc-username", $vc_dialog).val()),
								password: password,
								host_whitelist: host_whitelist,
								host_blacklist: host_blacklist,
								vc_collect_logs: vc_collect_logs,
							};
							if ($("#dialog-vc-collect-logs", $vc_dialog).prop("checked")) {

								params["vc_splunk_uri"] = vc_splunk_uri;
								params["vc_splunk_username"] = vc_splunk_username;
								params["vc_splunk_password"] = vc_splunk_password;
							}
							saveVC(params);
							$( this ).dialog( "close" );
							$(window).resize();
						}
					}
				}
			},
			close: function() {
				$(".dialog-field", $vc_dialog).val( "" ).removeClass( "ui-state-error" );
			}
		});
		$("#selected-vc-edit").click( function() {
			//Populate the dialog from selected node
			var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				$("#dialog-vc-name", $vc_dialog).val($.trim(data.stanza_name));
				$("#dialog-vc-path", $vc_dialog).val($.trim(data.target));
				$("#dialog-vc-username", $vc_dialog).val($('<div/>').html($.trim(data.username)).text());
				//Set the password to a phoney 8 dollar signs.
				$("#dialog-vc-password", $vc_dialog).val("$$$$$$$$");
				//Handle vc log forwarding
				if (data.forwarder_uri == null || data.forwarder_uri == "") {
					$("#dialog-vc-collect-logs", $vc_dialog).prop("checked", false);
					$(".dialog-vc-log-options", $vc_dialog).hide();
					$("#dialog-vc-splunk-uri", $vc_dialog).val("");
					$("#dialog-vc-splunk-username", $vc_dialog).val("");
					$("#dialog-vc-splunk-password", $vc_dialog).val("");
				}
				else {
					$("#dialog-vc-collect-logs", $vc_dialog).prop("checked", true);
					$(".dialog-vc-log-options", $vc_dialog).show();
					$("#dialog-vc-splunk-uri", $vc_dialog).val($.trim(data.forwarder_uri));
					$("#dialog-vc-splunk-username", $vc_dialog).val($.trim(data.forwarder_username));
					//Set the password to a phoney 8 dollar signs.
					$("#dialog-vc-splunk-password", $vc_dialog).val("$$$$$$$$");
				}
				//Handle managed hosts whitelist
				if ((data.managed_host_whitelist == null || data.managed_host_whitelist == "None") && (data.managed_host_blacklist == null || data.managed_host_blacklist == "None")) {
					$("#dialog-vc-collect-all-hosts", $vc_dialog).prop("checked", true);
					$(".dialog-vc-host-options", $vc_dialog).hide();
					$("#dialog-vc-host-whitelist", $vc_dialog).val("");
					$("#dialog-vc-host-blacklist", $vc_dialog).val("");
				}
				else {
					$("#dialog-vc-collect-all-hosts", $vc_dialog).prop("checked", false);
					$(".dialog-vc-host-options", $vc_dialog).show();
					$("#dialog-vc-host-whitelist", $vc_dialog).val(data.managed_host_whitelist && data.managed_host_whitelist != "None" ? data.managed_host_whitelist : "");
					$("#dialog-vc-host-blacklist", $vc_dialog).val(data.managed_host_blacklist && data.managed_host_blacklist != "None" ? data.managed_host_blacklist : "");
				}

				//Set title to edit one
				$vc_dialog.dialog("option", "title", "Edit Collection from Virtual Center");
			}
			else {
				//Set 'em blank
				$("#dialog-vc-name", $vc_dialog).val("");
				$("#dialog-vc-path", $vc_dialog).val("");
				$("#dialog-vc-username", $vc_dialog).val("");
				$("#dialog-vc-password", $vc_dialog).val("");
				$("#dialog-vc-collect-logs", $vc_dialog).prop("checked", false);
				$(".dialog-vc-log-options", $vc_dialog).hide();
				$("#dialog-vc-splunk-uri", $vc_dialog).val("");
				$("#dialog-vc-splunk-username", $vc_dialog).val("");
				$("#dialog-vc-splunk-password", $vc_dialog).val("");
				$("#dialog-vc-collect-all-hosts", $vc_dialog).prop("checked", true);
				$("#dialog-vc-host-options-container", $vc_dialog).hide();
				$("#dialog-vc-host-whitelist", $vc_dialog).val("");
				$("#dialog-vc-host-blacklist", $vc_dialog).val("");
				//Set title to creating new one
				$vc_dialog.dialog("option", "title", "Collect from New Virtual Center");
			}
			$vc_tips.html("");
			$vc_dialog.dialog("open");
		});
		$("#vc-add").click( function() {
			//Set dialog blank
			$("#dialog-vc-name", $vc_dialog).val("");
			$("#dialog-vc-path", $vc_dialog).val("");
			$("#dialog-vc-username", $vc_dialog).val("");
			$("#dialog-vc-password", $vc_dialog).val("");
			$("#dialog-vc-collect-logs", $vc_dialog).prop("checked", false);
			$(".dialog-vc-log-options", $vc_dialog).hide();
			$("#dialog-vc-splunk-uri", $vc_dialog).val("");
			$("#dialog-vc-splunk-username", $vc_dialog).val("");
			$("#dialog-vc-splunk-password", $vc_dialog).val("");
			$("#dialog-vc-collect-all-hosts", $vc_dialog).prop("checked", true);
			$(".dialog-vc-host-options", $vc_dialog).hide();
			$("#dialog-vc-host-whitelist", $vc_dialog).val("");
			$("#dialog-vc-host-blacklist", $vc_dialog).val("");
			//Set title to creating new one
			$vc_dialog.dialog("option", "title", "Collect from New Virtual Center");
			$vc_tips.html("");
			$vc_dialog.dialog("open");
		});
		var $vc_delete_dialog = $( "#vc-delete-confirm-dialog" ).dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			resizable: false,
			height: 250,
			width: 400,
			modal: true,
			buttons: {
				Cancel: {
					class: 'left-button',
					text: 'Cancel',
					click: function() {
						$( this ).dialog( "close" );
					}
				},
				"Delete Virtual Center": {
					class: 'right-button',
					text: 'Delete Virtual Center',
					click: function() {
						var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
						if (!selected_node.empty()) {
							var data = selected_node.data()[0];
							var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'delete_vcenter', encodeURIComponent($.trim(data.stanza_name)));
							disableUI();
							$.ajax({
								type: "DELETE",
								url:uri,
								beforeSend: function(xhr) {
									xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
								},
								success: function(rsp) {
									console.log("[splunk_for_vmware_setup] deleted node " + data.stanza_name);
									updateConfData();
								},
								error: function(jqXHR,textStatus,errorThrown) {
									console.log("[splunk_for_vmware_setup] AJAX Failure in deletion of node");
								},
							});
						}
						else {
							console.log("[splunk_for_vmware_setup] cannot delete a node when none are selected, please select a node to delete first.");
						}
						$( this ).dialog( "close" );
					}
				}
			}
		});
		$("#vc-delete").click( function() {
			//Populate the dialog from selected node
			var selected_node = d3.select("#vc-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				var data = selected_node.data()[0]; 
				var warn_bool = false
				if (data.forwarder_uri !== null && data.forwarder_uri !== "" && data.forwarder_uri !== undefined) {
					warn_bool = true;
				}
				if (warn_bool) {
					$(".log-collection-warning", $vc_delete_dialog).show();
				}
				else {
					$(".log-collection-warning", $vc_delete_dialog).hide();
				}
				$vc_delete_dialog.dialog("open");
			}
		});
		
		//Unmanaged host UI bindings
		/*
		var $unmanaged_dialog = $("#unmanaged-dialog");
		var $unmanaged_tips = $("p.validate-tips", $unmanaged_dialog);
		$unmanaged_dialog.dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			height: 300,
			width: 480,
			modal: true,
			buttons: {
				Cancel: {
					class: 'left-button',
					text: 'Cancel',
					click: function() {
						$(".dialog-field", $unmanaged_dialog).removeClass( "ui-state-error" );
						$( this ).dialog( "close" );
					}
				},
				"Save": {
					class: 'right-button',
					text: 'Save',
					click: function() {
						var validation = true;
						$(".dialog-field", $vc_dialog).removeClass( "ui-state-error" );
						
						validation = validation && checkRegexp( $('#dialog-unmanaged-path', $unmanaged_dialog), /[A-Za-z0-9\.\-_]/, "You must specify a virtual center domain", $unmanaged_tips) && checkRegexp( $('#dialog-unmanaged-path', $unmanaged_dialog), /^[^\r\n\t]*$/, "You must specify a valid virtual center domain", $unmanaged_tips);
						validation = validation && checkRegexp( $('#dialog-unmanaged-username', $unmanaged_dialog), /[A-Za-z0-9\.\-_]/, "You must specify a username", $unmanaged_tips) && checkRegexp( $('#dialog-unmanaged-username', $unmanaged_dialog), /^[^\r\n\t]*$/, "You must specify a valid username", $unmanaged_tips);
						validation = validation && checkRegexp( $('#dialog-unmanaged-password', $unmanaged_dialog), /./, "You must specify a password", $unmanaged_tips);
						if ( validation ) {
							var password = $("#dialog-unmanaged-password", $unmanaged_dialog).val();
							//if password is the default we set it to empty string to indicate no change
							password = password == "$$$$$$$$" ? "" : password;
							var params = {
								name: $("#dialog-unmanaged-name", $unmanaged_dialog).val(),
								host: $("#dialog-unmanaged-path", $unmanaged_dialog).val(),
								username: $("#dialog-unmanaged-username", $unmanaged_dialog).val(),
								password: password
							};
							saveUnmanaged(params);
							$( this ).dialog( "close" );
						}
					}
				}
			},
			close: function() {
					$(".dialog-field", $unmanaged_dialog).val( "" ).removeClass( "ui-state-error" );
			}
		});
		$("#selected-unmanaged-edit").click( function() {
			//Populate the dialog from selected node
			var selected_node = d3.select("#unmanaged-nodebar-container").select(".node-box.selected");
			if (!selected_node.empty()) {
				data = selected_node.data()[0];
				$("#dialog-unmanaged-name", $unmanaged_dialog).val(data.stanza_name);
				$("#dialog-unmanaged-path", $unmanaged_dialog).val(data.target);
				$("#dialog-unmanaged-username", $unmanaged_dialog).val(data.username);
				//Set the password to a phoney 8 dollar signs.
				$("#dialog-unmanaged-password", $unmanaged_dialog).val("$$$$$$$$");
				//Set title to edit one
				$unmanaged_dialog.dialog("option", "title", "Edit Collection from Unmanaged Host");
			}
			else {
				//Set 'em blank
				$("#dialog-unmanaged-name", $unmanaged_dialog).val("");
				$("#dialog-unmanaged-path", $unmanaged_dialog).val("");
				$("#dialog-unmanaged-username", $unmanaged_dialog).val("");
				$("#dialog-unmanaged-password", $unmanaged_dialog).val("");
				//Set title to creating new one
				$unmanaged_dialog.dialog("option", "title", "Collect from New Unmanaged Host");
			}
			$unmanaged_tips.html("");
			$unmanaged_dialog.dialog("open");
		});
		$("#unmanaged-add").click( function() {
			//Set dialog blank
			$("#dialog-unmanaged-name", $unmanaged_dialog).val("");
			$("#dialog-unmanaged-path", $unmanaged_dialog).val("");
			$("#dialog-unmanaged-username", $unmanaged_dialog).val("");
			$("#dialog-unmanaged-password", $unmanaged_dialog).val("");
			//Set title to creating new one
			$unmanaged_dialog.dialog("option", "title", "Collect from New Unmanaged Host");
			$unmanaged_tips.html("");
			$unmanaged_dialog.dialog("open");
		});
		
		var $unmanaged_delete_dialog = $( "#unmanaged-delete-confirm-dialog" ).dialog({
			autoOpen: false,
			dialogClass: "conf-dialog",
			resizable: false,
			height: 200,
			width: 400,
			modal: true,
			buttons: {
				Cancel: {
					class: 'left-button',
					text: 'Cancel',
					click: function() {
						$( this ).dialog( "close" );
					}
				},
				"Delete Unmanaged Host": {
					class: 'right-button',
					text: 'Delete Unmanaged Host',
					click: function() {
						var selected_node = d3.select("#unmanaged-nodebar-container").select(".node-box.selected");
						if (!selected_node.empty()) {
							var data = selected_node.data()[0];
							var uri = Splunk.util.make_url('custom', 'Splunk_TA_vmware' , 'splunk_for_vmware_setup', 'Splunk_TA_vmware', 'delete_unmanaged_host', encodeURIComponent(data.stanza_name));
							disableUI();
							$.ajax({
								type: "DELETE",
								url:uri,
								beforeSend: function(xhr) {
									xhr.setRequestHeader('X-Splunk-Form-Key', $('input[name=splunk_form_key]').val());
								},
								success: function(rsp) {
									console.log("[splunk_for_vmware_setup] deleted node " + data.stanza_name);
									updateConfData();
								},
								error: function(jqXHR,textStatus,errorThrown) {
									console.log("[splunk_for_vmware_setup] AJAX Failure in deletion of node");
								},
							});
						}
						else {
							console.log("[splunk_for_vmware_setup] cannot delete a node when none are selected, please select a node to delete first.");
						}
						$( this ).dialog( "close" );
					}
				}
			}
		});
		$("#unmanaged-delete").click( function() {
			$unmanaged_delete_dialog.dialog("open");
		});
		*/
		//Bind event handlers for hydra node
		$("#selected-hydra-node-validate", $node_container).click(validateHydraNode);
		//Initialize the node information
		updateHydraNodeBar();
		updateHydraNodeInfoBox();

		console.log("Finished rendering hydra nodes");
		
		// Bind validate icon click with appropriate method
		$("#selected-vc-validate", $vc_container).click(validateVC);
		
		//Initialize the vc information
		updateVCNodeBar();
		updateVCInfoBox();
		//Bind event handlers for vcenters
		$("#selected-vc-hosts").click(function() {
			console.log("Creating Managed hosts list")
			//Update the host lists
			hosts = d3.select("#vc-included-hosts-list").selectAll("li")
				.data(selected_vc_hosts.included_hosts, function(d) { return d; });
			hosts.enter()
				.append("li")
				.text(function(d) { return d; });
			
			hosts.exit().remove();
			
			if (selected_vc_hosts.included_hosts.length == 0) {
				$("#vc-included-hosts-msg").text("None");
			}
			else {
				$("#vc-included-hosts-msg").text("");
			}
			
			hosts = d3.select("#vc-excluded-hosts-list").selectAll("li")
				.data(selected_vc_hosts.excluded_hosts, function(d) { return d; });
			hosts.enter()
				.append("li")
				.text(function(d) { return d; });
			
			hosts.exit().remove();
			
			if (selected_vc_hosts.excluded_hosts.length == 0) {
				$("#vc-excluded-hosts-msg").text("None");
			}
			else {
				$("#vc-excluded-hosts-msg").text("");
			}
			
			$vc_hosts_dialog.dialog("open");
		});

		
		console.log("Finished rendering vcenters");
		//Initialize the unmanaged information
		//updateUnmanagedNodeBar();
		//updateUnmanagedInfoBox();
		$("#selected-unmanaged-validate", $unmanaged_container).click(validateUnmanaged);
		
		console.log("Finished rendering data");
	});
	</script>

## Preform the following if the user accessing the page is a Splunk admin:
% elif validadmin == "admin":
	<div class="layout">
		<div id="hydra-node-wrapper" class="conf-panel">
			<h1>
				Insufficient Access
			<h4>
				You are attempting to configure the data collection features of this system, but this has not been enabled. To enable this system to be used as a data collection scheduler, add the "splunk_vmware_admin" role to the admin account.
			</h4>
			</h1>
		</div>
	</div>
	
	
## Preform the following if the user accessing the page is NOT a valid admin:
% else:
	<div class="layout">
		<div id="hydra-node-wrapper" class="conf-panel">
			<h1>
				Insufficient Access
			<h4>
				You are trying to modify a page that you do not have access to, please contact your splunk administrator for more assistance.
			</h4>
			</h1>
		</div>
	</div>

% endif
